(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8521:(e,t,n)=>{Promise.resolve().then(n.bind(n,7789))},7789:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>H});var l=n(5155),i=n(2115),a=n(9552),r=n(6036),s=n(4665),o=n(2479),c=n(8648),x=n(9987),d=n(8998),u=n(6854),h=n(9030),p=n(8222),f=n(810),g=n(5330),m=n(9234),j=n(7821),A=n(5480);let y=e=>{let[t,n]=i.useState(0),[a,r]=i.useState([]),[y,C]=i.useState([]),[b,v]=i.useState({}),[w,T]=i.useState(!1),[k,S]=i.useState(null),[D,z]=i.useState(null),[E,_]=i.useState(null);i.useEffect(()=>{!async function(){T(!0);try{let e=await fetch("/api/json-files"),t=await e.json();r(t)}catch(e){console.error("Error fetching JSON files:",e)}finally{T(!1)}}()},[]);let q=async e=>{T(!0);try{let t=await fetch("/api/json-files/".concat(e,"/keys")),n=await t.json();C(n)}catch(e){console.error("Error loading JSON keys:",e)}finally{T(!1)}},W=async(e,t)=>{T(!0);try{let n=await fetch("/api/json-files/".concat(e,"/keys/").concat(t)),l=await n.json();v(e=>({...e,[t]:l}))}catch(e){console.error("Error loading JSON key content:",e)}finally{T(!1)}},I=e=>{S(k===e?null:e),b[e]||W(a[t],e)};i.useEffect(()=>{a.length>0&&q(a[0])},[a]);let R=(e,t)=>{e.preventDefault(),_(t),z(e.currentTarget)},O=e=>{e=e.replace(/ /g,"_");let t="https://danbooru.donmai.us/posts?tags=".concat(e);window.open(t,"_blank"),z(null)};return(0,l.jsxs)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,l.jsxs)(o.A,{sx:{height:"100%",display:"flex",flexDirection:"column",gap:2,p:3,overflow:"auto"},children:[(0,l.jsx)(c.A,{value:t,onChange:(e,t)=>{n(t),v({}),q(a[t])},variant:"scrollable",scrollButtons:"auto",sx:{px:2},children:a.map(e=>(0,l.jsx)(x.A,{label:e.replace(".json","")},e))}),(0,l.jsx)(d.A,{sx:{flex:1,p:2,borderTop:"1px solid",borderColor:"divider",overflowY:"auto"},children:w?(0,l.jsx)(u.A,{}):(0,l.jsx)(l.Fragment,{children:y.length>0?y.map(t=>(0,l.jsxs)(h.A,{expanded:k===t,onChange:()=>I(t),children:[(0,l.jsx)(p.A,{children:(0,l.jsx)(f.A,{variant:"body1",children:t})}),(0,l.jsx)(g.A,{children:(0,l.jsx)(d.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:b[t]?Object.entries(b[t]).map(t=>{let[n,i]=t;return(0,l.jsx)(m.A,{label:"".concat(i," (").concat(n,")"),variant:"outlined",size:"small",onClick:()=>{e.onAddTag&&e.onAddTag({cnText:i,originalEnText:n,curlyCount:0,squareCount:0})},onContextMenu:e=>R(e,n)},n)}):(0,l.jsx)(u.A,{size:20})})})]},t)):(0,l.jsx)(f.A,{variant:"body2",children:"请选择一个选项卡"})})})]}),(0,l.jsx)(j.A,{anchorEl:D,open:!!D,onClose:()=>{z(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:(0,l.jsx)(A.A,{onClick:()=>O(E),children:"在Danbooru上预览"})})]})};var C=n(2401),b=n(2282),v=n(6656),w=n(5394),T=n(4616),k=n(2688),S=n(679),D=n(5933);let z=e=>{let{onAddTag:t}=e,[n,a]=i.useState(3),[r,u]=i.useState(""),[h,p]=i.useState([]),[g,m]=i.useState(""),[j,A]=i.useState([]),[y,z]=i.useState(""),[E,_]=i.useState(""),[q,W]=i.useState([]),I={flex:1,minHeight:0,overflowY:"auto",p:1,border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"background.paper"},R={m:.5,textTransform:"none",fontSize:"0.75rem",py:.25,px:1,color:"text.secondary",borderWidth:1,"&:hover":{borderWidth:1}},O=async()=>{if(!r.trim())return;let e=r.split(",").map(e=>e.trim()).filter(e=>e);try{let t=await fetch("/api/Tagtranslate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({texts:e})});if(!t.ok)throw Error("Translation API error");let n=(await t.json()).translated_texts,l=e.map((e,t)=>({originalEnText:e,cnText:n&&n[t]?n[t]:e,curlyCount:0,squareCount:0}));p(e=>[...e,...l])}catch(n){let t=e.map(e=>({originalEnText:e,cnText:e,curlyCount:0,squareCount:0}));p(e=>[...e,...t])}},N=()=>{p([])},H=async()=>{if(g.trim())try{let e="/api/extract_tags?url=".concat(encodeURIComponent(g)),t=await fetch(e);if(!t.ok)throw Error("D站Tag API error");let n=(await t.json()).map(e=>({originalEnText:e.tag_name,cnText:e.translated_tag_name||e.tag_name,curlyCount:0,squareCount:0}));A(e=>[...e,...n])}catch(e){console.error(e)}},P=()=>{A([])},U=e=>{let t="/search/".concat(e,"?query=").concat(encodeURIComponent(y));return E.trim()&&(t+="&max_results=".concat(encodeURIComponent(E))),t},B=async e=>{if(y.trim())try{let t=U(e),n=await fetch(t);if(!n.ok)throw Error("".concat(e," search error"));let l=(await n.json()).map(e=>{let t=Object.keys(e)[0];return{originalEnText:t,cnText:e[t]||t,curlyCount:0,squareCount:0}});W(e=>[...e,...l])}catch(e){console.error(e)}},G=()=>B("regular_expression"),M=()=>B("fuzzy_search"),Y=()=>B("exact_search"),J=()=>W([]);return(0,l.jsx)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:(0,l.jsxs)(o.A,{sx:{flex:1,display:"flex",flexDirection:"column",p:0,minHeight:0},children:[(0,l.jsx)(c.A,{value:n,onChange:(e,t)=>{a(t)},variant:"fullWidth",sx:{borderBottom:1,borderColor:"divider"},children:["自定义","D站Tag导入","Tag搜索","关于"].map(e=>(0,l.jsx)(x.A,{label:e},e))}),(0,l.jsx)(d.A,{sx:{flex:1,p:2,overflow:"hidden",display:"flex",flexDirection:"column",gap:2,height:"100%"},children:(e=>{switch(e){case 0:return(0,l.jsxs)(d.A,{sx:{height:"100%",display:"flex",flexDirection:"column",gap:2,p:2},children:[(0,l.jsxs)(d.A,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[(0,l.jsx)(d.A,{sx:{flex:1},children:(0,l.jsx)(C.A,{fullWidth:!0,multiline:!0,minRows:3,maxRows:5,placeholder:"请在此输入你的tag串, tag将按照逗号划分开并添加为页面元素",variant:"outlined",value:r,onChange:e=>u(e.target.value),sx:{"& .MuiInputBase-root":{alignItems:"flex-start",overflow:"auto"}}})}),(0,l.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,l.jsx)(b.A,{variant:"contained",onClick:O,size:"small",children:"加载"}),(0,l.jsx)(b.A,{variant:"outlined",color:"error",onClick:N,size:"small",children:"清空"})]})]}),(0,l.jsx)(d.A,{sx:I,children:h.map((e,n)=>(0,l.jsx)(b.A,{variant:"outlined",size:"small",onClick:()=>t&&t(e),sx:R,children:"".concat(e.cnText," (").concat(e.originalEnText,")")},n))})]});case 1:return(0,l.jsxs)(d.A,{sx:{height:"100%",display:"flex",flexDirection:"column",gap:2,p:2},children:[(0,l.jsxs)(d.A,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[(0,l.jsx)(C.A,{fullWidth:!0,multiline:!0,minRows:3,maxRows:4,placeholder:"D站图像网址示例：https://danbooru.donmai.us/posts/114514",variant:"outlined",value:g,onChange:e=>m(e.target.value),sx:{"& .MuiInputBase-root":{alignItems:"flex-start",overflow:"auto"}}}),(0,l.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,l.jsx)(b.A,{variant:"contained",onClick:H,size:"small",children:"解析"}),(0,l.jsx)(b.A,{variant:"outlined",color:"error",onClick:P,size:"small",children:"清空"})]})]}),(0,l.jsx)(d.A,{sx:I,children:j.map((e,n)=>(0,l.jsx)(b.A,{variant:"outlined",size:"small",onClick:()=>t&&t(e),sx:R,children:"".concat(e.cnText," (").concat(e.originalEnText,")")},n))})]});case 2:return(0,l.jsxs)(d.A,{sx:{height:"100%",display:"flex",flexDirection:"column",gap:2,p:2},children:[(0,l.jsxs)(d.A,{sx:{display:"flex",gap:2,alignItems:"center"},children:[(0,l.jsx)(C.A,{fullWidth:!0,placeholder:"搜索内容（中英文皆可）",value:y,onChange:e=>z(e.target.value)}),(0,l.jsx)(C.A,{placeholder:"返回量",value:E,onChange:e=>_(e.target.value),sx:{width:100}})]}),(0,l.jsxs)(d.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(0,l.jsx)(b.A,{variant:"contained",onClick:G,size:"small",children:"正则"}),(0,l.jsx)(b.A,{variant:"contained",onClick:M,size:"small",children:"模糊"}),(0,l.jsx)(b.A,{variant:"contained",onClick:Y,size:"small",children:"精确"}),(0,l.jsx)(b.A,{variant:"outlined",color:"error",onClick:J,size:"small",children:"清空"})]}),(0,l.jsx)(d.A,{sx:I,children:q.map((e,n)=>(0,l.jsx)(b.A,{variant:"outlined",size:"small",onClick:()=>t&&t(e),sx:R,children:"".concat(e.cnText," (").concat(e.originalEnText,")")},n))})]});default:return(0,l.jsxs)(d.A,{sx:{height:"100%",display:"flex",flexDirection:"column",gap:2,p:3,overflow:"auto"},children:[(0,l.jsx)(f.A,{variant:"h5",sx:{fontWeight:600,color:"primary.main",borderBottom:"2px solid",borderColor:"primary.main",pb:1},children:"关于我们"}),(0,l.jsxs)(d.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:3,flexGrow:1},children:[(0,l.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,l.jsxs)(s.A,{variant:"outlined",sx:{p:2},children:[(0,l.jsx)(f.A,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:"网站信息"}),(0,l.jsxs)(f.A,{variant:"body2",sx:{lineHeight:1.6},children:["本平台是",(0,l.jsx)("b",{children:"Xianyun Draw Web"}),"生态的组成部分，提供专业的词条管理服务。 所有服务均免费提供，遵循"," ",(0,l.jsx)(v.A,{href:"https://nai.idlecloud.cc/terms",target:"_blank",rel:"noopener",children:"用户协议"}),"。"]})]}),(0,l.jsxs)(s.A,{variant:"outlined",sx:{p:2},children:[(0,l.jsx)(f.A,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:"开发相关"}),(0,l.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,l.jsxs)(v.A,{href:"https://github.com/YILING0013",target:"_blank",rel:"noopener",sx:{display:"flex",alignItems:"center",gap:1,color:"inherit"},children:[(0,l.jsx)(w.A,{fontSize:"small"})," GitHub 仓库"]}),(0,l.jsxs)(v.A,{href:"https://nai.idlecloud.cc",target:"_blank",rel:"noopener",sx:{display:"flex",alignItems:"center",gap:1,color:"inherit"},children:[(0,l.jsx)(T.A,{fontSize:"small"})," 绘图主站"]})]})]})]}),(0,l.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,l.jsxs)(s.A,{variant:"outlined",sx:{p:2},children:[(0,l.jsx)(f.A,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:"社区互动"}),(0,l.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,l.jsx)(b.A,{variant:"outlined",startIcon:(0,l.jsx)(k.A,{}),href:"https://qm.qq.com/cgi-bin/qm/qr?k=GmMDP5LFpfQiHZ56AtUhAfOuyUKKS3CC",target:"_blank",sx:{justifyContent:"flex-start"},children:"加入QQ群"}),(0,l.jsx)(b.A,{variant:"outlined",startIcon:(0,l.jsx)(S.A,{}),href:"https://space.bilibili.com/487156342",target:"_blank",sx:{justifyContent:"flex-start"},children:"Bilibili频道"})]})]}),(0,l.jsx)(s.A,{variant:"outlined",sx:{p:2,background:e=>"light"===e.palette.mode?"linear-gradient(45deg, #ffe9e9 30%, #f6f3ff 90%)":"linear-gradient(45deg, #2a2a2a 30%, #1a1a1a 90%)"},children:(0,l.jsxs)(d.A,{sx:{textAlign:"center"},children:[(0,l.jsx)(f.A,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:"支持我们"}),(0,l.jsx)(d.A,{sx:{width:80,height:80,margin:"0 auto 16px",background:"url(https://afdian.com/static/img/logo/logo.png) center/contain no-repeat"}}),(0,l.jsx)(b.A,{variant:"contained",color:"secondary",endIcon:(0,l.jsx)(D.A,{}),href:"https://afdian.com/a/lingyunfei",target:"_blank",sx:{borderRadius:20,px:4,textTransform:"none",boxShadow:1,"&:hover":{boxShadow:3}},children:"爱发电赞助"})]})})]})]}),(0,l.jsxs)(f.A,{variant:"caption",sx:{color:"text.secondary",textAlign:"center",mt:2},children:["\xa9 ",new Date().getFullYear()," Xianyun Project. All rights reserved."]})]})}})(n)})]})})};var E=n(1163),_=n(894),q=n(7740),W=n(7881),I=n(450);let R=e=>{let{tag:t,onUpdateTag:n,onDeleteTag:i,useRoundWeightSymbol:a}=e;return(0,l.jsxs)(d.A,{sx:{display:"inline-flex",alignItems:"center",border:"1px solid #ccc",borderRadius:1,p:.5,m:.2,backgroundColor:"#f9f9f9",cursor:"move"},"data-id":t.id,children:[(0,l.jsx)(_.A,{size:"small",sx:{p:.2},onClick:()=>{t.squareCount>0?n({...t,squareCount:t.squareCount-1}):n({...t,curlyCount:t.curlyCount+1})},children:(0,l.jsx)(q.A,{fontSize:"inherit"})}),(0,l.jsx)(_.A,{size:"small",sx:{p:.2},onClick:()=>{t.curlyCount>0?n({...t,curlyCount:t.curlyCount-1}):n({...t,squareCount:t.squareCount+1})},children:(0,l.jsx)(W.A,{fontSize:"inherit"})}),(0,l.jsx)(f.A,{variant:"body2",sx:{mx:.2},children:t.cnText}),(0,l.jsx)(f.A,{variant:"body2",sx:{mx:.5},children:t.curlyCount>0?(a?"(":"{").repeat(t.curlyCount)+t.originalEnText+(a?")":"}").repeat(t.curlyCount):t.squareCount>0?"[".repeat(t.squareCount)+t.originalEnText+"]".repeat(t.squareCount):t.originalEnText}),(0,l.jsx)(_.A,{size:"small",sx:{p:.2},onClick:()=>i(t.id),children:(0,l.jsx)(I.A,{fontSize:"inherit"})})]})},O=e=>{let{tags:t,onUpdateTag:n,onDeleteTag:c,onReorderTags:x,onClearTags:u}=e,[h,p]=i.useState(!1),f=()=>t.map(e=>{if(e.curlyCount>0){let t=h?"(":"{",n=h?")":"}";return t.repeat(e.curlyCount)+e.originalEnText+n.repeat(e.curlyCount)}return e.squareCount>0?"[".repeat(e.squareCount)+e.originalEnText+"]".repeat(e.squareCount):e.originalEnText}).join(", ");return(0,l.jsx)(a.A,{maxWidth:!1,disableGutters:!0,children:(0,l.jsxs)(r.A,{container:!0,spacing:.5,children:[(0,l.jsx)(r.A,{size:{xs:12,md:8},children:(0,l.jsx)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:(0,l.jsx)(o.A,{sx:{flex:1,display:"flex",minHeight:250,flexDirection:"column"},children:(0,l.jsx)(d.A,{sx:{flex:1,p:1,border:"1px dashed grey",borderRadius:1,overflowY:"auto",display:"flex",flexWrap:"wrap"},children:(0,l.jsx)(E.ReactSortable,{list:t,setList:x,tag:"div",options:{animation:150},children:t.map(e=>(0,l.jsx)(R,{tag:e,onUpdateTag:n,onDeleteTag:c,useRoundWeightSymbol:h},e.id))})})})})}),(0,l.jsx)(r.A,{size:{xs:12,md:4},children:(0,l.jsx)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:(0,l.jsxs)(o.A,{sx:{flex:1,display:"flex",flexDirection:"column",gap:2},children:[(0,l.jsx)(C.A,{fullWidth:!0,multiline:!0,minRows:5,maxRows:5,placeholder:"这里是调整后的词条输出",value:f(),"aria-readonly":"true"}),(0,l.jsxs)(d.A,{sx:{display:"flex",justifyContent:"space-between",gap:2},children:[(0,l.jsx)(b.A,{variant:"contained",color:"primary",fullWidth:!0,onClick:()=>{let e=f(),t=()=>{let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")?alert("已复制到剪贴板！"):alert("复制失败")}catch(e){alert("复制失败")}document.body.removeChild(t)};navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>{alert("已复制到剪贴板！")}).catch(()=>{t()}):t()},children:"复制 Copy"}),(0,l.jsx)(b.A,{variant:"contained",color:"error",fullWidth:!0,onClick:u,children:"清空 Clear"}),(0,l.jsx)(b.A,{variant:"contained",color:"info",fullWidth:!0,onClick:()=>{p(e=>!e)},children:"切换加权符号"})]})]})})})]})})};function N(){let[e,t]=(0,i.useState)([]),n=e=>{t(t=>[...t,{...e,id:Date.now().toString()+Math.random().toString()}])};return(0,l.jsxs)(a.A,{maxWidth:!1,disableGutters:!0,sx:{height:"100vh",p:1,display:"flex",flexDirection:"column",gap:.5},children:[(0,l.jsx)(r.A,{container:!0,spacing:.5,children:(0,l.jsx)(r.A,{size:{xs:12,md:12},children:(0,l.jsx)(O,{tags:e,onUpdateTag:e=>{t(t=>t.map(t=>t.id===e.id?e:t))},onDeleteTag:e=>{t(t=>t.filter(t=>t.id!==e))},onReorderTags:e=>{t(e)},onClearTags:()=>{t([])}})})}),(0,l.jsxs)(r.A,{container:!0,spacing:.5,sx:{flex:1,minHeight:{xs:550,sm:0}},children:[(0,l.jsx)(r.A,{size:{xs:12,md:8},sx:{height:"100%"},children:(0,l.jsx)(y,{onAddTag:n})}),(0,l.jsx)(r.A,{size:{xs:12,md:4},sx:{height:"100%"},children:(0,l.jsx)(z,{onAddTag:n})})]})]})}function H(){return(0,l.jsx)("div",{style:{height:"100vh"},children:(0,l.jsx)(N,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[658,441,517,358],()=>t(8521)),_N_E=e.O()}]);