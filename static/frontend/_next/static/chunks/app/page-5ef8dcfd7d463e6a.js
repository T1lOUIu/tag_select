(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8521:(e,n,t)=>{Promise.resolve().then(t.bind(t,7789))},7789:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>N});var r=t(5155),i=t(2115),a=t(9552),l=t(6036),o=t(4665),s=t(2479),c=t(8648),x=t(9987),d=t(8998),u=t(6854),h=t(9030),p=t(8222),g=t(810),f=t(5330),j=t(9234),m=t(7821),A=t(5480);let y=e=>{let[n,t]=i.useState(0),[a,l]=i.useState([]),[y,C]=i.useState([]),[v,b]=i.useState({}),[T,w]=i.useState(!1),[k,S]=i.useState(null),[D,E]=i.useState(null),[W,_]=i.useState(null);i.useEffect(()=>{!async function(){w(!0);try{let e=await fetch("/api/json-files"),n=await e.json();l(n)}catch(e){console.error("Error fetching JSON files:",e)}finally{w(!1)}}()},[]);let q=async e=>{w(!0);try{let n=await fetch("/api/json-files/".concat(e,"/keys")),t=await n.json();C(t)}catch(e){console.error("Error loading JSON keys:",e)}finally{w(!1)}},z=async(e,n)=>{w(!0);try{let t=await fetch("/api/json-files/".concat(e,"/keys/").concat(n)),r=await t.json();b(e=>({...e,[n]:r}))}catch(e){console.error("Error loading JSON key content:",e)}finally{w(!1)}},R=e=>{S(k===e?null:e),v[e]||z(a[n],e)};i.useEffect(()=>{a.length>0&&q(a[0])},[a]);let I=(e,n)=>{e.preventDefault(),_(n),E(e.currentTarget)},H=e=>{window.open("https://danbooru.donmai.us/posts?tags=".concat(e),"_blank"),E(null)};return(0,r.jsxs)(o.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,r.jsxs)(s.A,{sx:{flex:1,display:"flex",minHeight:300,flexDirection:"column",p:0},children:[(0,r.jsx)(c.A,{value:n,onChange:(e,n)=>{t(n),b({}),q(a[n])},variant:"scrollable",scrollButtons:"auto",sx:{px:2},children:a.map(e=>(0,r.jsx)(x.A,{label:e.replace(".json","")},e))}),(0,r.jsx)(d.A,{sx:{flex:1,p:2,borderTop:"1px solid",borderColor:"divider",overflowY:"auto"},children:T?(0,r.jsx)(u.A,{}):(0,r.jsx)(r.Fragment,{children:y.length>0?y.map(n=>(0,r.jsxs)(h.A,{expanded:k===n,onChange:()=>R(n),children:[(0,r.jsx)(p.A,{children:(0,r.jsx)(g.A,{variant:"body1",children:n})}),(0,r.jsx)(f.A,{children:(0,r.jsx)(d.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:v[n]?Object.entries(v[n]).map(n=>{let[t,i]=n;return(0,r.jsx)(j.A,{label:"".concat(i," (").concat(t,")"),variant:"outlined",size:"small",onClick:()=>{e.onAddTag&&e.onAddTag({cnText:i,originalEnText:t,curlyCount:0,squareCount:0})},onContextMenu:e=>I(e,t)},t)}):(0,r.jsx)(u.A,{size:20})})})]},n)):(0,r.jsx)(g.A,{variant:"body2",children:"请选择一个选项卡"})})})]}),(0,r.jsx)(m.A,{anchorEl:D,open:!!D,onClose:()=>{E(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:(0,r.jsx)(A.A,{onClick:()=>H(W),children:"在Danbooru上预览"})})]})};var C=t(2401),v=t(2282),b=t(6656),T=t(5394),w=t(4616),k=t(2688),S=t(679),D=t(5933);let E=e=>{let{onAddTag:n}=e,[t,a]=i.useState(3),[l,u]=i.useState(""),[h,p]=i.useState([]),[f,j]=i.useState(""),[m,A]=i.useState([]),[y,E]=i.useState(""),[W,_]=i.useState(""),[q,z]=i.useState([]),R=async()=>{if(!l.trim())return;let e=l.split(",").map(e=>e.trim()).filter(e=>e);try{let n=await fetch("/api/Tagtranslate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({texts:e})});if(!n.ok)throw Error("Translation API error");let t=(await n.json()).translated_texts,r=e.map((e,n)=>({originalEnText:e,cnText:t&&t[n]?t[n]:e,curlyCount:0,squareCount:0}));p(e=>[...e,...r])}catch(t){let n=e.map(e=>({originalEnText:e,cnText:e,curlyCount:0,squareCount:0}));p(e=>[...e,...n])}},I=()=>{p([])},H=async()=>{if(f.trim())try{let e="/api/extract_tags?url=".concat(encodeURIComponent(f)),n=await fetch(e);if(!n.ok)throw Error("D站Tag API error");let t=(await n.json()).map(e=>({originalEnText:e.tag_name,cnText:e.translated_tag_name||e.tag_name,curlyCount:0,squareCount:0}));A(e=>[...e,...t])}catch(e){console.error(e)}},O=()=>{A([])},N=e=>{let n="/search/".concat(e,"?query=").concat(encodeURIComponent(y));return W.trim()&&(n+="&max_results=".concat(encodeURIComponent(W))),n},B=async e=>{if(y.trim())try{let n=N(e),t=await fetch(n);if(!t.ok)throw Error("".concat(e," search error"));let r=(await t.json()).map(e=>{let n=Object.keys(e)[0];return{originalEnText:n,cnText:e[n]||n,curlyCount:0,squareCount:0}});z(e=>[...e,...r])}catch(e){console.error(e)}},P=()=>{B("regular_expression")},U=()=>{B("fuzzy_search")},Y=()=>{B("exact_search")},G=()=>{z([])};return(0,r.jsx)(o.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:(0,r.jsxs)(s.A,{sx:{flex:1,display:"flex",flexDirection:"column",p:0,minHeight:0},children:[(0,r.jsx)(c.A,{value:t,onChange:(e,n)=>{a(n)},variant:"fullWidth",sx:{borderBottom:1,borderColor:"divider"},children:["自定义","D站Tag导入","Tag搜索","关于"].map(e=>(0,r.jsx)(x.A,{label:e},e))}),(0,r.jsx)(d.A,{sx:{flex:1,p:2,overflow:"hidden",display:"flex",flexDirection:"column",gap:2,height:"100%"},children:(e=>{switch(e){case 0:return(0,r.jsxs)(d.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,r.jsx)(g.A,{variant:"h6",gutterBottom:!0,children:"自定义"}),(0,r.jsx)(C.A,{fullWidth:!0,multiline:!0,minRows:3,placeholder:"请在此输入你的tag串, tag将按照逗号划分开并添加为页面元素",variant:"outlined",value:l,onChange:e=>u(e.target.value)}),(0,r.jsxs)(d.A,{sx:{marginTop:2,display:"flex",gap:2},children:[(0,r.jsx)(v.A,{variant:"contained",color:"primary",onClick:R,children:"加载 Tag"}),(0,r.jsx)(v.A,{variant:"contained",color:"error",onClick:I,children:"清空 Tag"})]}),(0,r.jsx)(d.A,{sx:{marginTop:2,display:"flex",flexWrap:"wrap",gap:1,flex:1,minHeight:0,overflowY:"auto",p:1,border:"1px solid #ddd",borderRadius:1},children:h.map((e,t)=>(0,r.jsx)(v.A,{variant:"outlined",size:"small",onClick:()=>n&&n(e),children:"".concat(e.cnText," (").concat(e.originalEnText,")")},t))})]});case 1:return(0,r.jsxs)(d.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,r.jsx)(g.A,{variant:"h6",gutterBottom:!0,children:"D站Tag导入"}),(0,r.jsx)(C.A,{fullWidth:!0,multiline:!0,minRows:3,placeholder:"在此处输入D站某张图像的网址，例如：https://danbooru.donmai.us/posts/114514",variant:"outlined",value:f,onChange:e=>j(e.target.value)}),(0,r.jsxs)(d.A,{sx:{marginTop:2,display:"flex",gap:2},children:[(0,r.jsx)(v.A,{variant:"contained",color:"primary",onClick:H,children:"加载 Tag"}),(0,r.jsx)(v.A,{variant:"contained",color:"error",onClick:O,children:"清空 Tag"})]}),(0,r.jsx)(d.A,{sx:{marginTop:2,display:"flex",flexWrap:"wrap",gap:1,flex:1,minHeight:0,overflowY:"auto",p:1,border:"1px solid #ddd",borderRadius:1},children:m.map((e,t)=>(0,r.jsx)(v.A,{variant:"outlined",size:"small",onClick:()=>n&&n(e),children:"".concat(e.cnText," (").concat(e.originalEnText,")")},t))})]});case 2:return(0,r.jsxs)(d.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,r.jsx)(g.A,{variant:"h6",gutterBottom:!0,children:"Tag搜索"}),(0,r.jsx)(C.A,{fullWidth:!0,placeholder:"请在此输入你要搜索的内容，中英文皆可",variant:"outlined",value:y,onChange:e=>E(e.target.value)}),(0,r.jsxs)(d.A,{sx:{marginTop:2,display:"flex",gap:2},children:[(0,r.jsx)(v.A,{variant:"contained",color:"primary",onClick:P,children:"正则搜索"}),(0,r.jsx)(v.A,{variant:"contained",color:"primary",onClick:U,children:"模糊搜索"}),(0,r.jsx)(v.A,{variant:"contained",color:"primary",onClick:Y,children:"精确搜索"})]}),(0,r.jsx)(C.A,{sx:{marginTop:2},fullWidth:!0,placeholder:"返回量: 无值则全部返回",variant:"outlined",value:W,onChange:e=>_(e.target.value)}),(0,r.jsx)(d.A,{sx:{marginTop:2,display:"flex",gap:2},children:(0,r.jsx)(v.A,{variant:"contained",color:"error",onClick:G,children:"清空 Tag"})}),(0,r.jsx)(d.A,{sx:{marginTop:2,display:"flex",flexWrap:"wrap",gap:1,flex:1,minHeight:0,overflowY:"auto",p:1,border:"1px solid #ddd",borderRadius:1},children:q.map((e,t)=>(0,r.jsx)(v.A,{variant:"outlined",size:"small",onClick:()=>n&&n(e),children:"".concat(e.cnText," (").concat(e.originalEnText,")")},t))})]});default:return(0,r.jsxs)(d.A,{sx:{height:"100%",display:"flex",flexDirection:"column",gap:2,p:3,overflow:"auto"},children:[(0,r.jsx)(g.A,{variant:"h5",sx:{fontWeight:600,color:"primary.main",borderBottom:"2px solid",borderColor:"primary.main",pb:1},children:"关于我们"}),(0,r.jsxs)(d.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:3,flexGrow:1},children:[(0,r.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,r.jsxs)(o.A,{variant:"outlined",sx:{p:2},children:[(0,r.jsx)(g.A,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:"网站信息"}),(0,r.jsxs)(g.A,{variant:"body2",sx:{lineHeight:1.6},children:["本平台是",(0,r.jsx)("b",{children:"Xianyun Draw Web"}),"生态的组成部分，提供专业的词条管理服务。 所有服务均免费提供，遵循"," ",(0,r.jsx)(b.A,{href:"https://nai.idlecloud.cc/terms",target:"_blank",rel:"noopener",children:"用户协议"}),"。"]})]}),(0,r.jsxs)(o.A,{variant:"outlined",sx:{p:2},children:[(0,r.jsx)(g.A,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:"开发相关"}),(0,r.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,r.jsxs)(b.A,{href:"https://github.com/YILING0013",target:"_blank",rel:"noopener",sx:{display:"flex",alignItems:"center",gap:1,color:"inherit"},children:[(0,r.jsx)(T.A,{fontSize:"small"}),"GitHub 仓库"]}),(0,r.jsxs)(b.A,{href:"https://nai.idlecloud.cc",target:"_blank",rel:"noopener",sx:{display:"flex",alignItems:"center",gap:1,color:"inherit"},children:[(0,r.jsx)(w.A,{fontSize:"small"}),"绘图主站"]})]})]})]}),(0,r.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,r.jsxs)(o.A,{variant:"outlined",sx:{p:2},children:[(0,r.jsx)(g.A,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:"社区互动"}),(0,r.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,r.jsx)(v.A,{variant:"outlined",startIcon:(0,r.jsx)(k.A,{}),href:"https://qm.qq.com/cgi-bin/qm/qr?k=GmMDP5LFpfQiHZ56AtUhAfOuyUKKS3CC",target:"_blank",sx:{justifyContent:"flex-start"},children:"加入QQ群"}),(0,r.jsx)(v.A,{variant:"outlined",startIcon:(0,r.jsx)(S.A,{}),href:"https://space.bilibili.com/487156342",target:"_blank",sx:{justifyContent:"flex-start"},children:"Bilibili频道"})]})]}),(0,r.jsx)(o.A,{variant:"outlined",sx:{p:2,background:e=>"light"===e.palette.mode?"linear-gradient(45deg, #ffe9e9 30%, #f6f3ff 90%)":"linear-gradient(45deg, #2a2a2a 30%, #1a1a1a 90%)"},children:(0,r.jsxs)(d.A,{sx:{textAlign:"center"},children:[(0,r.jsx)(g.A,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:"支持我们"}),(0,r.jsx)(d.A,{sx:{width:80,height:80,margin:"0 auto 16px",background:"url(https://afdian.com/static/img/logo/logo.png) center/contain no-repeat"}}),(0,r.jsx)(v.A,{variant:"contained",color:"secondary",endIcon:(0,r.jsx)(D.A,{}),href:"https://afdian.com/a/lingyunfei",target:"_blank",sx:{borderRadius:20,px:4,textTransform:"none",boxShadow:1,"&:hover":{boxShadow:3}},children:"爱发电赞助"})]})})]})]}),(0,r.jsxs)(g.A,{variant:"caption",sx:{color:"text.secondary",textAlign:"center",mt:2},children:["\xa9 ",new Date().getFullYear()," Xianyun Project. All rights reserved."]})]})}})(t)})]})})};var W=t(1163),_=t(894),q=t(7740),z=t(7881),R=t(450);let I=e=>{let{tag:n,onUpdateTag:t,onDeleteTag:i,useRoundWeightSymbol:a}=e;return(0,r.jsxs)(d.A,{sx:{display:"inline-flex",alignItems:"center",border:"1px solid #ccc",borderRadius:1,p:.5,m:.2,backgroundColor:"#f9f9f9",cursor:"move"},"data-id":n.id,children:[(0,r.jsx)(_.A,{size:"small",sx:{p:.2},onClick:()=>{n.squareCount>0?t({...n,squareCount:n.squareCount-1}):t({...n,curlyCount:n.curlyCount+1})},children:(0,r.jsx)(q.A,{fontSize:"inherit"})}),(0,r.jsx)(_.A,{size:"small",sx:{p:.2},onClick:()=>{n.curlyCount>0?t({...n,curlyCount:n.curlyCount-1}):t({...n,squareCount:n.squareCount+1})},children:(0,r.jsx)(z.A,{fontSize:"inherit"})}),(0,r.jsx)(g.A,{variant:"body2",sx:{mx:.2},children:n.cnText}),(0,r.jsx)(g.A,{variant:"body2",sx:{mx:.5},children:n.curlyCount>0?(a?"(":"{").repeat(n.curlyCount)+n.originalEnText+(a?")":"}").repeat(n.curlyCount):n.squareCount>0?"[".repeat(n.squareCount)+n.originalEnText+"]".repeat(n.squareCount):n.originalEnText}),(0,r.jsx)(_.A,{size:"small",sx:{p:.2},onClick:()=>i(n.id),children:(0,r.jsx)(R.A,{fontSize:"inherit"})})]})},H=e=>{let{tags:n,onUpdateTag:t,onDeleteTag:c,onReorderTags:x,onClearTags:u}=e,[h,p]=i.useState(!1),g=()=>n.map(e=>{if(e.curlyCount>0){let n=h?"(":"{",t=h?")":"}";return n.repeat(e.curlyCount)+e.originalEnText+t.repeat(e.curlyCount)}return e.squareCount>0?"[".repeat(e.squareCount)+e.originalEnText+"]".repeat(e.squareCount):e.originalEnText}).join(", ");return(0,r.jsx)(a.A,{maxWidth:!1,disableGutters:!0,children:(0,r.jsxs)(l.A,{container:!0,spacing:.5,children:[(0,r.jsx)(l.A,{size:{xs:12,md:8},children:(0,r.jsx)(o.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:(0,r.jsx)(s.A,{sx:{flex:1,display:"flex",minHeight:250,flexDirection:"column"},children:(0,r.jsx)(d.A,{sx:{flex:1,p:1,border:"1px dashed grey",borderRadius:1,overflowY:"auto",display:"flex",flexWrap:"wrap"},children:(0,r.jsx)(W.ReactSortable,{list:n,setList:x,tag:"div",options:{animation:150},children:n.map(e=>(0,r.jsx)(I,{tag:e,onUpdateTag:t,onDeleteTag:c,useRoundWeightSymbol:h},e.id))})})})})}),(0,r.jsx)(l.A,{size:{xs:12,md:4},children:(0,r.jsx)(o.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:(0,r.jsxs)(s.A,{sx:{flex:1,display:"flex",flexDirection:"column",gap:2},children:[(0,r.jsx)(C.A,{fullWidth:!0,multiline:!0,minRows:5,maxRows:5,placeholder:"这里是调整后的词条输出",value:g(),"aria-readonly":"true"}),(0,r.jsxs)(d.A,{sx:{display:"flex",justifyContent:"space-between",gap:2},children:[(0,r.jsx)(v.A,{variant:"contained",color:"primary",fullWidth:!0,onClick:()=>{let e=g();navigator.clipboard.writeText(e).then(()=>{alert("已复制到剪贴板！")}).catch(()=>{alert("复制失败")})},children:"复制 Copy"}),(0,r.jsx)(v.A,{variant:"contained",color:"error",fullWidth:!0,onClick:u,children:"清空 Clear"}),(0,r.jsx)(v.A,{variant:"contained",color:"info",fullWidth:!0,onClick:()=>{p(e=>!e)},children:"切换加权符号"})]})]})})})]})})};function O(){let[e,n]=(0,i.useState)([]),t=e=>{n(n=>[...n,{...e,id:Date.now().toString()+Math.random().toString()}])};return(0,r.jsxs)(a.A,{maxWidth:!1,disableGutters:!0,sx:{height:"100vh",p:1,display:"flex",flexDirection:"column",gap:.5},children:[(0,r.jsx)(l.A,{container:!0,spacing:.5,children:(0,r.jsx)(l.A,{size:{xs:12,md:12},children:(0,r.jsx)(H,{tags:e,onUpdateTag:e=>{n(n=>n.map(n=>n.id===e.id?e:n))},onDeleteTag:e=>{n(n=>n.filter(n=>n.id!==e))},onReorderTags:e=>{n(e)},onClearTags:()=>{n([])}})})}),(0,r.jsxs)(l.A,{container:!0,spacing:.5,sx:{flex:1,minHeight:0},children:[(0,r.jsx)(l.A,{size:{xs:12,md:8},sx:{height:"100%"},children:(0,r.jsx)(y,{onAddTag:t})}),(0,r.jsx)(l.A,{size:{xs:12,md:4},sx:{height:"100%"},children:(0,r.jsx)(E,{onAddTag:t})})]})]})}function N(){return(0,r.jsx)("div",{style:{height:"100vh"},children:(0,r.jsx)(O,{})})}}},e=>{var n=n=>e(e.s=n);e.O(0,[658,441,517,358],()=>n(8521)),_N_E=e.O()}]);